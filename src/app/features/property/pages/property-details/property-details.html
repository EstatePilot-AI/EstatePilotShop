<section class="property-details-page">
  <!-- ── Back Navigation ──────────────────────────────────── -->
  <header class="page-header">
    <div class="container">
      <div class="page-header-inner">
        <a routerLink="/properties/list" class="back-link" aria-label="Back to property listings">
          <i class="pi pi-arrow-left" aria-hidden="true"></i>
          Back to Listings
        </a>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- ── Error State ─────────────────────────────────────── -->
    @if (error()) {
      <div class="state-wrapper" role="alert">
        <p-message severity="error" [text]="error()!" styleClass="w-full" />
        <p-button
          label="Try Again"
          icon="pi pi-refresh"
          class="mt-3"
          (onClick)="reload()"
        />
      </div>
    }

    <!-- ── Loading Skeleton ────────────────────────────────── -->
    @if (loading() && !error()) {
      <div class="details-layout" aria-busy="true" aria-label="Loading property details">
        <div class="details-hero">
          <p-skeleton height="360px" styleClass="skeleton-image" borderRadius="16px" />
        </div>
        <div class="details-content">
          <p-skeleton width="50%" height="2rem" styleClass="mb-3" />
          <p-skeleton width="70%" height="1.25rem" styleClass="mb-2" />
          <p-skeleton width="40%" height="1rem" styleClass="mb-4" />
          <p-skeleton width="100%" height="1px" styleClass="mb-4" />
          <div class="skeleton-stats">
            @for (item of [1, 2, 3, 4]; track $index) {
              <p-skeleton width="100%" height="4rem" borderRadius="12px" />
            }
          </div>
          <p-skeleton width="100%" height="1px" styleClass="my-4" />
          <p-skeleton width="60%" height="1.25rem" styleClass="mb-2" />
          <p-skeleton width="80%" height="1rem" styleClass="mb-2" />
          <p-skeleton width="70%" height="1rem" />
        </div>
      </div>
    }

    <!-- ── Property Details ────────────────────────────────── -->
    @if (!loading() && !error() && property(); as p) {
      <div class="details-layout">
        <!-- Hero Image / Placeholder -->
        <div class="details-hero">
          <div class="hero-placeholder" aria-hidden="true">
            <i class="pi pi-building"></i>
          </div>
          <div class="hero-badges">
            <p-tag
              [value]="p.propertyStatus"
              [severity]="statusSeverity(p.propertyStatus)"
              [rounded]="true"
            />
            <span class="type-pill">{{ p.propertyType }}</span>
          </div>
        </div>

        <!-- Content Panel -->
        <div class="details-content">
          <!-- Price & ID -->
          <div class="content-header">
            <h1 class="property-price">{{ formattedPrice() }}</h1>
            <span class="property-id">ID #{{ p.propertyId }}</span>
          </div>

          <!-- Location -->
          <p class="property-location">
            <i class="pi pi-map-marker" aria-hidden="true"></i>
            {{ fullAddress() }}
          </p>

          <p-divider />

          <!-- Quick Stats Grid -->
          <div class="stats-grid">
            <div class="stat-card">
              <i class="pi pi-th-large stat-icon" aria-hidden="true"></i>
              <div class="stat-info">
                <span class="stat-value">{{ p.area }} m²</span>
                <span class="stat-label">Area</span>
              </div>
            </div>
            <div class="stat-card">
              <i class="pi pi-home stat-icon" aria-hidden="true"></i>
              <div class="stat-info">
                <span class="stat-value">{{ p.rooms }}</span>
                <span class="stat-label">Rooms</span>
              </div>
            </div>
            <div class="stat-card">
              <i class="pi pi-inbox stat-icon" aria-hidden="true"></i>
              <div class="stat-info">
                <span class="stat-value">{{ p.bathrooms }}</span>
                <span class="stat-label">Bathrooms</span>
              </div>
            </div>
            <div class="stat-card">
              <i class="pi pi-check-circle stat-icon" aria-hidden="true"></i>
              <div class="stat-info">
                <span class="stat-value">{{ p.finishingType }}</span>
                <span class="stat-label">Finishing</span>
              </div>
            </div>
          </div>

          <p-divider />

          <!-- Location Details -->
          <h2 class="section-title">
            <i class="pi pi-map" aria-hidden="true"></i>
            Location Details
          </h2>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Country</span>
              <span class="info-value">{{ p.country }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Governorate</span>
              <span class="info-value">{{ p.governorate }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">City</span>
              <span class="info-value">{{ p.city }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">District</span>
              <span class="info-value">{{ p.district }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Street</span>
              <span class="info-value">{{ p.street }}</span>
            </div>
          </div>

          <p-divider />

          <!-- Building Details -->
          <h2 class="section-title">
            <i class="pi pi-building stat-icon" aria-hidden="true"></i>
            Building Details
          </h2>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Building No.</span>
              <span class="info-value">{{ p.buildingNumber }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Floor</span>
              <span class="info-value">{{ p.floorNumber }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Apartment No.</span>
              <span class="info-value">{{ p.apartmentNumber }}</span>
            </div>
          </div>

          <!-- CTA -->
          <div class="details-actions">
            <p-button
              label="Contact Us"
              icon="pi pi-envelope"
              styleClass="w-full"
              (onClick)="openContactDialog()"
              aria-label="Contact us about this property"
            />
            <p-button
              label="Back to Listings"
              icon="pi pi-arrow-left"
              styleClass="w-full"
              [outlined]="true"
              routerLink="/properties/list"
              aria-label="Back to property listings"
            />
          </div>
        </div>
      </div>
    }
  </div>

  <!-- ── Contact Dialog ──────────────────────────────────── -->
  @if (property(); as p) {
    <app-contact-dialog
      [propertyId]="p.propertyId"
      [(visible)]="dialogVisible"
      (submitted)="onContactSent()"
      (submitError)="onContactError($event)"
    />
  }

  <p-toast />
</section>
